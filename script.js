const quizData = 
[
 
  {
    question: "Lab session can conduct without projector and LED?",
    a: "True",
    b: "False",
    c: "Sometimes",
    d: "Optional",
    correct: "b"
  },
  {
    question: "Lab session can be completed by LF learner login?",
    a: "False",
    b: "Optional",
    c: "True",
    d: "Not Required",
    correct: "c"
  },
  {
    question: "How many session should be completed by the learner to get eligible for KYP final Exam in BS-CIT?",
    a: "45",
    b: "30",
    c: "48",
    d: "90",
    correct: "c"
  },
  {
    question: "Oncet is mandatory for being a valid LF?",
    a: "False",
    b: "No",
    c: "True",
    d: "Optional",
    correct: "c"
  },
  {
    question: "Learner marks never deducted in any session?",
    a: "none",
    b: "True",
    c: "May be",
    d: "False",
    correct: "d"
  },
  {
    question: "Without BS-CIT book Learner can not start ERA learning?",
    a: "True",
    b: "False",
    c: "Required",
    d: "Mandatory",
    correct: "b"
  },
  {
    question: "Learning period for KYP is?",
    a: "2 month",
    b: "6 month",
    c: "3 month",
    d: "1 year",
    correct: "c"
  },
  {
    question: "LF should decide the flow of lab session and classroom in well advance?",
    a: "No",
    b: "Later",
    c: "May be",
    d: "Yes",
    correct: "d"
  },
  {
    question: "KYP course duration is of THREE MONTH?",
    a: "No",
    b: "Optional",
    c: "Yes",
    d: "False",
    correct: "c"
  },
  {
    question: "How much minimum capacity of RAM required for client machine?",
    a: "2GB",
    b: "1GB",
    c: "4GB",
    d: "8GB",
    correct: "c"
  },
  {
    question: "Online certificate after result declared can be viewed on website?",
    a: "No",
    b: "Not Sure",
    c: "True",
    d: "False",
    correct: "c"
  },
  {
    question: "How many session be completed by the learner to get eligible for KYP Final Exam in BS-SCC?",
    a: "30",
    b: "60",
    c: "20",
    d: "16",
    correct: "d"
  },
  {
    question: "ERA activation takes how long time?",
    a: "More than 1 hour",
    b: "Less than 30 min",
    c: "1 day",
    d: "30 sec",
    correct: "b"
  },
  {
    question: "How many roles are identified for SDC to run KYP program?",
    a: "Three",
    b: "Two",
    c: "Four",
    d: "Five",
    correct: "c"
  },
  {
    question: "How much is the confirmation deposit for single learner?",
    a: "1500",
    b: "500",
    c: "2000",
    d: "1000",
    correct: "d"
  },
  {
    question: "If learner completed 60 session but unable to score minimum 20 marks internal assessment in BS-CIT then can he appear for BS-CIT final exam?",
    a: "Yes",
    b: "No",
    c: "May be",
    d: "Optional",
    correct: "b"
  },
  {
    question: "Candidate qualified minimum 12th with KYP is preferred as the LF?",
    a: "No",
    b: "Yes",
    c: "May be",
    d: "Not required",
    correct: "b"
  },
  {
    question: "At district Registration counselling center student can verify his/her document?",
    a: "No",
    b: "True",
    c: "False",
    d: "Not Sure",
    correct: "b"
  },
  {
    question: "What is the eligibility criteria for being LF at SDC?",
    a: "Graduate only",
    b: "KYP Pass only",
    c: "All the above",
    d: "12th pass only",
    correct: "c"
  },
  {
    question: "You can access all KYP courses (120 session) in welcome course?",
    a: "Yes",
    b: "False",
    c: "True",
    d: "Partially",
    correct: "b"
  },
  {
    question: "Projector or LCD Screen is compulsory to conduct classroom session?",
    a: "False",
    b: "No",
    c: "TRUE",
    d: "Optional",
    correct: "c"
  },
  {
    question: "If learner has taken admission in 1st January batch and he fails to complete learning till the May month what will happen?",
    a: "Can extend",
    b: "He can not appear for Exam anymore",
    c: "Still eligible",
    d: "Allowed with late fee",
    correct: "b"
  },
  {
    question: "LF Learner fail in Fresh KYP exam then how many attempt remaining?",
    a: "1", 
    b: "2",
    c: "0",
    d: "3",
    correct: "b"
  },
  {
    question: "Who will be able to close exam from OES?",
    a: "Only Admin",
    b: "Both 2&3",
    c: "Only LF",
    d: "Only Learner",
    correct: "b"
  },
  {
    question: "How many challenges are there in BS-CSS course?",
    a: "500",
    b: "400",
    c: "600",
    d: "700",
    correct: "c"
  },
  {
    question: "Where SDC can confirm admission?",
    a: "ERA only",
    b: "Solar only",
    c: "Website only",
    d: "ERA & Solar",
    correct: "b"
  },
  {
    question: "LF can show processfolios in classroom session?",
    a: "False",
    b: "True",
    c: "Optional",
    d: "None of these",
    correct: "b"
  },
  {
    question: "Learner can not use LF login for ERA learning?",
    a: "True",
    b: "False",
    c: "Optional",
    d: "None of these",
    correct: "a"
  },
  {
    question: "CCTV is compulsory for KYP SDC?",
    a: "Something",
    b: "False",
    c: "Optional",
    d: "True",
    correct: "d"
  },
  {
    question: "What is age criteria for girls to get benefit of KYP?",
    a: "18-24",
    b: "15-25",
    c: "16-23",
    d: "17-21",
    correct: "b"
  },
  {
    question: "When we install MS-Office in system then what will be the default drive on system?",
    a: "D drive",
    b: "E drive",
    c: "C drive",
    d: "F drive",
    correct: "c"
  },
  {
    question: "All session should be thoroughly by Learning Facilitator?",
    a: "Yes",
    b: "Optional",
    c: "Sometimes",
    d: "No",
    correct: "a"
  },
  {
    question: "In ERA you can resume your learning by where left last time?",
    a: "Something",
    b: "True",
    c: "False",
    d: "Not Sure",
    correct: "b"
  },
  {
    question: "Learner can take admission multiple times for KYP?",
    a: "True",
    b: "False",
    c: "Optional",
    d: "Depends",
    correct: "b"
  },
  {
    question: "Security deposit is only collected from SHA learner?",
    a: "No",
    b: "none",
    c: "False",
    d: "True",
    correct: "d"
  },
  {
    question: "LF and Coordinator login are combined in one login as LF login?",
    a: "False",
    b: "none",
    c: "Optional",
    d: "True",
    correct: "d"
  },
  {
    question: "What is the link or URL to verify certificate?",
    a: "http;//skillmissionbihar.org/EF/exam/certificateDisplay.jsp?jvld=11",
    b: "skillbihar.gov.in",
    c: "bssc.gov.in",
    d: "cert.bihar.gov.in",
    correct: "a"
  },
  {
    question: "To view the result status need to select the following option",
    a: "Exam Dashboard",
    b: "View Score",
    c: "Final Exam Result",
    d: "Check Marks",
    correct: "c"
  },
  {
    question: "To resolve the any candidate queries toll free number is made available on website",
    a: "No",
    b: "Optional",
    c: "True",
    d: "False",
    correct: "c"
  },
  {
    question: "Learner Able to Take Exam from solar",
    a: "No",
    b: "Optional",
    c: "False",
    d: "True",
    correct: "d"
  },
  {
    question: "SDC can take classroom session without projector or LCD display",
    a: "True",
    b: "False",
    c: "Optional",
    d: "Sometimes",
    correct: "b"
  },
  {
    question: "How much minimum capacity of hard disk required for Client Machine",
    a: "80 GB",
    b: "120 GB",
    c: "160 GB",
    d: "500 GB",
    correct: "c"
  },
  {
    question: "From which everyday classes starts?",
    a: "Lab",
    b: "Classroom",
    c: "Exam",
    d: "Practice",
    correct: "b"
  },
  {
    question: "Learner login can be viewed by using Report tab",
    a: "False",
    b: "True",
    c: "Optional",
    d: "None of these",
    correct: "b"
  },
  {
    question: "If learner completed 20 session but unable to score minimum 20 marks in internal assessment in BS-CLS then can he appear for BS-CLS final exam?",
    a: "True",
    b: "False",
    c: "Maybe",
    d: "None of these",
    correct: "b"
  },
  {
    question: "Cyber security skill part of CIT course",
    a: "True",
    b: "False",
    c: "Optional",
    d: "None of these",
    correct: "a"
  },
  {
    question: "Exam data Upload in?",
    a: "ERA",
    b: "Solar",
    c: "All of these",
    d: "OES",
    correct: "c"
  },
  {
    question: "Learner have to complete minimum 30 session to be eligible for BS-CLS final exam",
    a: "True",
    b: "False",
    c: "none",
    d: "Optional",
    correct: "a"
  },
  {
    question: "KYP comes under which Scheme of Bihar Government",
    a: "SKILL INDIA",
    b: "PMKVY",
    c: "KUSHAL YUVA PROGRAM",
    d: "NSDC",
    correct: "c"
  },
  {
    question: "After learning completion student can give Final Exam Any time",
    a: "True",
    b: "Optional",
    c: "False",
    d: "Yes",
    correct: "c"
  }

];

// Allowed Learner Codes
const validLearnerCodes = ["9853","9852","5687","7856","7895","7854","7854","4578","5468","5664","6895","6597","4897","4598","4568","3548","3698","6542"
]; // Yahan apne learner codes add karo

// DOM Elements
const loginForm = document.getElementById('loginForm');
const quizSection = document.getElementById('quizSection');
const marksheet = document.getElementById('marksheet');
const answerEls = document.querySelectorAll('.answer');
const questionEl = document.getElementById('question');
const a_text = document.getElementById('a_text');
const b_text = document.getElementById('b_text');
const c_text = document.getElementById('c_text');
const d_text = document.getElementById('d_text');
const submitBtn = document.getElementById('submit');
const studentName = document.getElementById('studentName');
const studentEmail = document.getElementById('studentEmail');
const learnerCode = document.getElementById('learnerCode');
const timerElement = document.getElementById('timer');
const resetButton = document.getElementById('resetButton');
const marksheetName = document.getElementById('marksheetName');
const marksheetEmail = document.getElementById('marksheetEmail');
const marksheetCode = document.getElementById('marksheetCode');
const marksheetScore = document.getElementById('marksheetScore');
const studentTableBody = document.getElementById('studentTableBody');

let currentQuiz = 0;
let score = 0;
let shuffledQuizData = [];
let timeLeft = 30;
let timerInterval;

// Shuffle function
function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

// Handle Login and Store Data
function handleLogin() {
  const name = studentName.value.trim();
  const email = studentEmail.value.trim();
  const learnerCodeValue = learnerCode.value.trim();

  if (name && email && learnerCodeValue) {

    // ✅ Learner code validation
    if (!validLearnerCodes.includes(learnerCodeValue)) {
      alert("गलत Learner Code. कृपया सही कोड दर्ज करें।");
      return;
    }

    // Store user data in sessionStorage
    sessionStorage.setItem('studentName', name);
    sessionStorage.setItem('studentEmail', email);
    sessionStorage.setItem('learnerCode', learnerCodeValue);

    // Hide login and show quiz section
    loginForm.style.display = 'none';
    quizSection.style.display = 'block';

    // Set marksheet fields
    marksheetName.value = name;
    marksheetEmail.value = email;
    marksheetCode.value = learnerCodeValue;

    // Shuffle quiz data and load quiz
    shuffledQuizData = shuffle([...quizData]);
    loadQuiz();
  } else {
    alert("कृपया सभी फ़ील्ड्स भरें।");
  }
}

// Load Quiz Data
function loadQuiz() {
  deselectAnswers();
  const currentQuizData = shuffledQuizData[currentQuiz];
  questionEl.innerText = `Q${currentQuiz + 1}: ${currentQuizData.question}`;
  a_text.innerText = currentQuizData.a;
  b_text.innerText = currentQuizData.b;
  c_text.innerText = currentQuizData.c;
  d_text.innerText = currentQuizData.d;

  timeLeft = 30;
  updateTimer();
  startTimer();
}

// Deselect Answers
function deselectAnswers() {
  answerEls.forEach(answerEl => (answerEl.checked = false));
}

// Get Selected Answer
function getSelected() {
  let answer;
  answerEls.forEach(answerEl => {
    if (answerEl.checked) {
      answer = answerEl.id;
    }
  });
  return answer;
}

// Start Timer
function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (timeLeft > 0) {
      timeLeft--;
      updateTimer();
    } else {
      clearInterval(timerInterval);
      currentQuiz++;
      if (currentQuiz < shuffledQuizData.length) {
        loadQuiz();
      } else {
        showMarksheet();
      }
    }
  }, 1000);
}

// Update Timer
function updateTimer() {
  timerElement.innerText = `Time: ${timeLeft}s`;
  if (timeLeft <= 5) {
    timerElement.classList.add('warning');
  } else {
    timerElement.classList.remove('warning');
  }
}

// Submit Answer
submitBtn.addEventListener('click', () => {
  const answer = getSelected();
  if (answer) {
    if (answer === shuffledQuizData[currentQuiz].correct) {
      score++;
    }
    currentQuiz++;
    if (currentQuiz < shuffledQuizData.length) {
      loadQuiz();
    } else {
      showMarksheet();
    }
  } else {
    alert("कृपया उत्तर चुनें।");
  }
});

// Show Marksheet
function showMarksheet() {
  clearInterval(timerInterval);
  quizSection.style.display = 'none';
  marksheet.style.display = 'block';

  // Set score in marksheet
  marksheetScore.value = `आपने ${score}/${shuffledQuizData.length} प्रश्न सही उत्तर दिए।`;

  // Add record to student records table
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${sessionStorage.getItem('studentName')}</td>
    <td>${sessionStorage.getItem('studentEmail')}</td>
    <td>${sessionStorage.getItem('learnerCode')}</td>
    <td>${score}</td>
  `;
  studentTableBody.appendChild(row);
}

// Reset Quiz
function resetQuiz() {
  loginForm.style.display = 'block';
  marksheet.style.display = 'none';
  studentName.value = '';
  studentEmail.value = '';
  learnerCode.value = '';
  score = 0;
  currentQuiz = 0;
  clearInterval(timerInterval);
  timerElement.innerText = 'Time: 30s';
}

// Event Listeners
document.getElementById('loginButton').addEventListener('click', handleLogin);
resetButton.addEventListener('click', resetQuiz);







    document.getElementById('saveMarksheetButton').addEventListener('click', function () {
      var name = document.getElementById('marksheetName').value;
      var email = document.getElementById('marksheetEmail').value;
      var learnerCode = document.getElementById('marksheetCode').value;
      var score = document.getElementById('marksheetScore').value;

      // Data to send
      var formData = new FormData();
      formData.append('name', name);
      formData.append('email', email);
      formData.append('learnerCode', learnerCode);
      formData.append('score', score);

      // Sending data to Google Sheets
      fetch('https://script.google.com/macros/s/AKfycbydA0-XIneVPgkMeasUzjR_bhyiDEL5xyXMsEb_DYN9QVHFEfQiPcrmSElNZwi_rpgM/exec', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        alert(data); // Display success message
        document.getElementById('marksheet').style.display = 'none';
        document.getElementById('studentRecords').style.display = 'block';
      })
      .catch(error => alert('Error saving data: ' + error));
    });
    
    
const now = Date.now();
const siteOpenedTime = localStorage.getItem('siteOpenedTime');
const siteOpenCount = parseInt(localStorage.getItem('siteOpenCount') || '0', 10);
const firstVisitTime = localStorage.getItem('firstVisitTime');

// Agar first visit time exist karta hai
if (firstVisitTime) {
    const firstVisit = parseInt(firstVisitTime, 10);
    const hoursPassed = (now - firstVisit) / (1000 * 60 * 60); // ms to hours

    if (hoursPassed >= 12) {
        // 12 ghante ho gaye - data reset karo
        localStorage.setItem('firstVisitTime', now.toString());
        localStorage.setItem('siteOpenCount', '0');
        localStorage.removeItem('siteOpenedTime');
    }
} else {
    // First time ever
    localStorage.setItem('firstVisitTime', now.toString());
    localStorage.setItem('siteOpenCount', '0');
}

// Ab firse updated values lo
const updatedSiteOpenCount = parseInt(localStorage.getItem('siteOpenCount') || '0', 10);
const updatedSiteOpenedTime = localStorage.getItem('siteOpenedTime');

if (updatedSiteOpenCount >= 2) {
    document.body.innerHTML = "<h2>Sorry! Aap is device par sirf 2 baar hi site open kar sakte hain (12 ghante mein).</h2>";
} else {
    if (updatedSiteOpenedTime) {
        const openedAt = parseInt(updatedSiteOpenedTime, 10);
        const diffInMinutes = (now - openedAt) / (1000 * 60);

        if (diffInMinutes < 30) {
            document.body.innerHTML = "<h2>Sorry! Aap abhi site use nahi kar sakte. 30 minutes ka wait karein.</h2>";
        } else {
            // 30 minutes ho gaye, open allow karo
            localStorage.setItem('siteOpenedTime', now.toString());
            localStorage.setItem('siteOpenCount', (updatedSiteOpenCount + 1).toString());
        }
    } else {
        // Pehli baar ya 30 minutes ke baad pehli baar
        localStorage.setItem('siteOpenedTime', now.toString());
        localStorage.setItem('siteOpenCount', (updatedSiteOpenCount + 1).toString());
    }
}
    
 







// Right Click Disable
document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
}, false);

// Shortcut Keys Disable
document.onkeydown = function (e) {
    // F12
    if (e.keyCode == 123) return false;
    // Ctrl+Shift+I
    if (e.ctrlKey && e.shiftKey && e.keyCode == 73) return false;
    // Ctrl+Shift+J
    if (e.ctrlKey && e.shiftKey && e.keyCode == 74) return false;
    // Ctrl+U
    if (e.ctrlKey && e.keyCode == 85) return false;
    // Ctrl+Shift+C
    if (e.ctrlKey && e.shiftKey && e.keyCode == 67) return false;
    // Ctrl+S
    if (e.ctrlKey && e.keyCode == 83) return false;
    // Ctrl+A
    if (e.ctrlKey && e.keyCode == 65) return false;
    // Ctrl+C
    if (e.ctrlKey && e.keyCode == 67) return false;
};

// Prevent drag select
document.addEventListener('selectstart', e => e.preventDefault());
document.addEventListener('dragstart', e => e.preventDefault());




	// Disable text selection
document.addEventListener('selectstart', function(e) {
    e.preventDefault();
});

// Disable right-click
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Disable drag events (to prevent dragging content)
document.addEventListener('dragstart', function(e) {
    e.preventDefault();
});


document.addEventListener('copy', function(e) {
    e.preventDefault(); // Default copy ko roke
    const fakeText = "Copying is not allowed. Visit our site directly: https://yourwebsite.com";
    if (e.clipboardData) {
        e.clipboardData.setData('text/plain', fakeText);
    } else if (window.clipboardData) {
        window.clipboardData.setData('Text', fakeText);
    }
    alert("Copying is disabled on this site!");
});